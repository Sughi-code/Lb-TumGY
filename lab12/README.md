# Movie Rental API with Kinopoisk Integration

## Описание

Это REST API для управления видеопрокатом с интеграцией с Kinopoisk API. Приложение позволяет управлять фильмами, клиентами и арендой, а также получать дополнительную информацию о фильмах из Kinopoisk API.

## Возможности

- CRUD-операции для фильмов, клиентов и аренды
- Расширенные детали фильма с интеграцией Kinopoisk API
- Поддержка фильтрации, сортировки и пагинации
- Миграции базы данных
- Автоматическое создание структуры базы данных при запуске

## Технологии

- PHP 8+
- SQLite
- FastRoute для маршрутизации
- cURL для HTTP-запросов к API
- Composer для управления зависимостями

## Установка и настройка

1. Убедитесь, что у вас установлены PHP 8+ и SQLite
2. Установите зависимости:
   ```bash
   cd public
   composer install
   ```
3. Запустите приложение (миграции запустятся автоматически при первом запросе)

## API Endpoints

### Основные endpoints:

- `GET /films` - получить все фильмы
- `GET /films/{id}` - получить фильм по ID
- `POST /films` - создать фильм
- `PUT /films/{id}` - обновить фильм
- `DELETE /films/{id}` - удалить фильм

- `GET /customers` - получить всех клиентов
- `GET /customers/{id}` - получить клиента по ID
- `POST /customers` - создать клиента
- `PUT /customers/{id}` - обновить клиента
- `DELETE /customers/{id}` - удалить клиента

- `GET /rentals` - получить все аренды
- `GET /rentals/{id}` - получить аренду по ID
- `POST /rentals` - создать аренду
- `PUT /rentals/{id}` - обновить аренду
- `DELETE /rentals/{id}` - удалить аренду

- `GET /stores` - получить все магазины
- `GET /stores/{id}` - получить магазин по ID

### Расширенный endpoint для деталей фильма:

- `GET /films/{id}/details?fields=details,reviews,persons,similar,images,rating` - получить расширенные детали фильма

Параметр `fields` может содержать следующие значения:
- `details` - основная информация о фильме из Kinopoisk
- `reviews` - отзывы на фильм
- `persons` - персонал фильма (актеры, режиссеры и т.д.)
- `similar` - похожие фильмы
- `images` - изображения (обложки)
- `rating` - рейтинги (Kinopoisk, IMDb)

## Интеграция с Kinopoisk API

Приложение интегрировано с Kinopoisk API (неофициальный) и использует следующие методы:

- Поиск фильма по названию
- Получение детальной информации о фильме
- Получение отзывов
- Получение изображений
- Получение информации о персонале

## Структура проекта

```
lab12/
├── public/
│   ├── config.php          # Конфигурация приложения
│   ├── index.php           # Основной файл приложения
│   ├── insert_test_films.php # Скрипт для добавления тестовых фильмов
│   ├── composer.json       # Зависимости
│   ├── controllers/        # Контроллеры
│   ├── models/            # Модели
│   └── services/          # Сервисы
├── resources/
│   └── sql/               # SQL-скрипты миграций
└── README.md              # Документация
```

## Миграции

Миграции автоматически запускаются при подключении к базе данных. Если таблицы не существуют, они будут созданы с помощью SQL-скриптов из папки `resources/sql/`.

## Основные действия, выполненные в задаче:

1. **Структура базы данных**: Созданы отдельные SQL-скрипты для каждой таблицы в папке `resources/sql/`
2. **Механизм миграций**: Реализован автоматический запуск миграций при подключении к базе данных, адаптированный для SQLite
3. **Интеграция с Kinopoisk API**: Добавлен сервис для работы с API и новый endpoint `/films/{id}/details`
4. **Обработка ошибок**: Реализована обработка ошибок от третьестороннего API
5. **Тестовые данные**: Добавлены реальные названия фильмов, которые можно найти в Kinopoisk API

## Тестирование

Для тестирования API можно использовать Postman или curl. В проекте включена коллекция Postman с примерами запросов.

## Обработка ошибок API

Приложения корректно обрабатывает ошибки от Kinopoisk API, включая:
- Неверный API-ключ
- Ограничение по количеству запросов
- Отсутствие фильма в базе Kinopoisk
- Ошибки сети и соединения

## Заключение

Приложение успешно реализует все требуемые функции, включая интеграцию с Kinopoisk API, механизм миграций и расширенный endpoint для получения деталей фильма.

## Архитектурные решения и реализация

### 1. Выбор языков программирования

- **PHP** - основной язык для реализации логики API, моделей, контроллеров и сервисов
- **SQL** - для создания структуры базы данных и выполнения запросов
- **JavaScript** - для обработки клиентских запросов (при необходимости)
- **HTML** - для представления данных (при необходимости)

### 2. Использование предоставленных данных для решения задачи

- Использован предоставленный API-ключ Kinopoisk: `PW0WYZQ-7VTMC6Q-G1K5K69-11YM3C3`
- Использована документация Kinopoisk API для интеграции
- Реализован endpoint `/films/{id}/details` с поддержкой выбора полей
- Добавлены тестовые фильмы с реальными названиями, совместимыми с Kinopoisk API

### 3. Основные реализованные функции

- **Механизм миграций**: Автоматическое создание таблиц при запуске приложения
- **Интеграция с Kinopoisk API**: Получение дополнительной информации о фильмах
- **Расширенный endpoint**: `/films/{id}/details` с поддержкой выбора полей
- **Обработка ошибок**: От третьестороннего API и внутренних ошибок
- **Фильтрация и пагинация**: Для всех основных сущностей

### 4. Архитектурные паттерны

- **MVC**: Модели, представления, контроллеры разделены по слоям
- **Сервисный слой**: Для работы с внешними API
- **Фасад для конфигурации**: Единая точка подключения к базе данных

### 5. Безопасность и надежность

- Использование подготовленных выражений (prepared statements) для предотвращения SQL-инъекций
- Валидация входных данных
- Обработка ошибок с логированием
- Защита от инъекций в API-запросы