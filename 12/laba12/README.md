# Лабораторная работа 12 - Исправленный API для работы с фильмами

## Внесенные исправления

### 1. Обработка ошибок
- Добавлена обработка исключений в API-функции (getAllFilms, getFilmById, getFilmDetails)
- Исправлены проблемы с QueryBuilder, который вызывал exit() напрямую
- Улучшена обработка ошибок подключения к базе данных
- Добавлена обработка ошибок для API-запросов к Кинопоиску

### 2. Безопасность и надежность
- Исправлены потенциальные уязвимости в SQL-запросах
- Добавлена защита от SQL-инъекций через правильное использование подготовленных выражений
- Улучшена обработка пользовательского ввода

### 3. Архитектура
- Исправлены зависимости между модулями
- Улучшена структура обработки ошибок
- Добавлена обработка миграций базы данных

## Требования

- PHP 8.0 или выше
- MySQL 5.7 или выше
- Composer

## Установка

1. Установите зависимости:
```bash
composer install
```

2. Настройте базу данных в файле `.env`

3. Запустите приложение:
```bash
php -S localhost:8000 -t public/
```

## API Эндпоинты

- `GET /films` - получить все фильмы
- `GET /films/{id}` - получить фильм по ID
- `GET /films/{id}/details?fields=details,persons,rating` - получить детали фильма с Кинопоиска

## Конфигурация

Создайте файл `.env` в папке `public/` с настройками:

```
DB_HOST=127.0.0.1
DB_USER=ваш_пользователь
DB_PASS=ваш_пароль
DB_NAME=имя_базы
KINOPOISK_API_KEY=ваш_api_ключ
```